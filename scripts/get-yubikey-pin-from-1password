#!/bin/bash
# Retrieve YubiKey PIN from 1Password for step-ca
# This script is called by step-ca to get the PIN dynamically

set -euo pipefail

# Use service account to retrieve PIN
export HOME=/var/lib/step-ca/tmp

/usr/local/bin/op-with-service-account document get "YubiKey NEO - ca.funlab.casa (SN: 5497305)"     --vault "Funlab.Casa.Ca" | grep "^PIN:" | cut -d: -f2 | tr -d ' \n'
